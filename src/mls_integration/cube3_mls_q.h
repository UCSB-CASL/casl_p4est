#ifndef cube3_mls_q_H
#define cube3_mls_q_H

/*
 *            18----------21----------24
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *        19----------22----------25   |
 *        /|   |      /|   |      /|   |
 *       / |   9-----/-|--12-----/-|--15
 *      /  |  /|    /  |  /|    /  |  /|
 *    20----------23----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |  10-------|--13-------|--16   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---3---|-/-|---6
 *     |/  |  /    |/  |  /    |/  |  /
 *    11----------14----------17   | /
 *     |   |/      |   |/      |   |/
 *     |   1-------|---4-------|---7
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     2-----------5-----------8
 *
 */

const int num_faces = 12;
const double fp[num_faces][6] = { { 0,  2,  8,  1,  5,  4  },
                                  { 0,  6,  8,  3,  7,  4  },
                                  { 18, 20, 26, 19, 23, 22 },
                                  { 18, 24, 26, 21, 25, 22 },
                                  { 0,  6,  24, 3,  15, 12 },
                                  { 0,  18, 24, 9,  21, 12 },
                                  { 2,  8,  26, 5,  17, 14 },
                                  { 2,  20, 26, 11, 23, 14 },
                                  { 0,  2,  20, 1,  11, 10 },
                                  { 0,  18, 20, 9,  19, 10 },
                                  { 6,  8,  26, 7,  17, 16 },
                                  { 6,  24, 26, 15, 25, 16 } };
const int num_edges = 12;
const double ep[num_edges][3] = { { 0,  1,  2  },
                                  { 6,  7,  8  },
                                  { 18, 19, 20 },
                                  { 24, 25, 26 },
                                  { 0,  3,  6  },
                                  { 2,  5,  8  },
                                  { 18, 21, 24 },
                                  { 20, 23, 26 },
                                  { 0,  9,  18 },
                                  { 2,  11, 20 },
                                  { 6,  15, 24 },
                                  { 8,  17, 26 } };
const int num_tetrs_q = 6;
const double tp_q[num_tetrs_q][10] = { { 0, 2,  8,  26, 1,  5,  4,  13, 14, 17},
                                       { 0, 8,  6,  26, 4,  7,  3,  13, 17, 16},
                                       { 0, 20, 2,  26, 10, 11, 1,  13, 23, 14},
                                       { 0, 6,  24, 26, 3,  15, 12, 13, 16, 25},
                                       { 0, 18, 20, 26, 9,  19, 10, 13, 22, 23},
                                       { 0, 24, 18, 26, 12, 21, 9,  13, 25, 22} };

#define NUM_TETS 6

// Tetrahedron #0
/*
 *             o-----------o-----------o
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         o-----------o-----------o   |
 *        /|   |      /|   |      /|   |
 *       / |   o-----/-|---o-----/-|---o
 *      /  |  /|    /  |  /|    /  |  /|
 *     o-----------o----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |   o-------|--13-------|---o   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---o---|-/-|---o
 *     |/  |  /    |/  |  /    |/  |  /
 *     o----------14----------17   | /
 *     |   |/      |   |/      |   |/
 *     |   1-------|---4-------|---o
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     2-----------5-----------8
 *
 */
#define q_t0p0 0
#define q_t0p1 2
#define q_t0p2 8
#define q_t0p3 26
#define q_t0p4 1
#define q_t0p5 5
#define q_t0p6 4
#define q_t0p7 13
#define q_t0p8 14
#define q_t0p9 17
// Tetrahedron #1
/*
 *             *-----------*-----------*
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         *-----------*-----------*   |
 *        /|   |      /|   |      /|   |
 *       / |   *-----/-|---*-----/-|---*
 *      /  |  /|    /  |  /|    /  |  /|
 *     *-----------*----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |   *-------|--13-------|--16   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---3---|-/-|---6
 *     |/  |  /    |/  |  /    |/  |  /
 *     *-----------*----------17   | /
 *     |   |/      |   |/      |   |/
 *     |   *-------|---4-------|---7
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     *-----------*-----------8
 *
 */
#define q_t1p0 0
#define q_t1p1 8
#define q_t1p2 6
#define q_t1p3 26
#define q_t1p4 4
#define q_t1p5 7
#define q_t1p6 3
#define q_t1p7 13
#define q_t1p8 17
#define q_t1p9 16
// Tetrahedron #2

/*
 *             *-----------*-----------*
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         *-----------*-----------*   |
 *        /|   |      /|   |      /|   |
 *       / |   *-----/-|---*-----/-|---*
 *      /  |  /|    /  |  /|    /  |  /|
 *    20----------23----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |  10-------|--13-------|---*   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---*---|-/-|---*
 *     |/  |  /    |/  |  /    |/  |  /
 *    11----------14-----------*   | /
 *     |   |/      |   |/      |   |/
 *     |   1-------|---*-------|---*
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     2-----------*-----------*
 *
 */
#define q_t2p0 0
#define q_t2p1 20
#define q_t2p2 2
#define q_t2p3 26
#define q_t2p4 10
#define q_t2p5 11
#define q_t2p6 1
#define q_t2p7 13
#define q_t2p8 23
#define q_t2p9 14
// Tetrahedron #3
/*
 *             *-----------*----------24
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         *-----------*----------25   |
 *        /|   |      /|   |      /|   |
 *       / |   *-----/-|--12-----/-|--15
 *      /  |  /|    /  |  /|    /  |  /|
 *     *-----------*----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |   *-------|--13-------|--16   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---3---|-/-|---6
 *     |/  |  /    |/  |  /    |/  |  /
 *     *-----------*-----------*   | /
 *     |   |/      |   |/      |   |/
 *     |   *-------|---*-------|---*
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     *-----------*-----------*
 *
 */
#define q_t3p0 0
#define q_t3p1 6
#define q_t3p2 24
#define q_t3p3 26
#define q_t3p4 3
#define q_t3p5 15
#define q_t3p6 12
#define q_t3p7 13
#define q_t3p8 16
#define q_t3p9 25
// Tetrahedron #4
/*
 *            18-----------*-----------*
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *        19----------22-----------*   |
 *        /|   |      /|   |      /|   |
 *       / |   9-----/-|---*-----/-|---*
 *      /  |  /|    /  |  /|    /  |  /|
 *    20----------23----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |  10-------|--13-------|---*   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---*---|-/-|---*
 *     |/  |  /    |/  |  /    |/  |  /
 *     *-----------*-----------*   | /
 *     |   |/      |   |/      |   |/
 *     |   *-------|---*-------|---*
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     *-----------*-----------*
 *
 */
#define q_t4p0 0
#define q_t4p1 18
#define q_t4p2 20
#define q_t4p3 26
#define q_t4p4 9
#define q_t4p5 19
#define q_t4p6 10
#define q_t4p7 13
#define q_t4p8 22
#define q_t4p9 23
// Tetrahedron #5
/*
 *            18----------21----------24
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         *----------22----------25   |
 *        /|   |      /|   |      /|   |
 *       / |   9-----/-|--12-----/-|---*
 *      /  |  /|    /  |  /|    /  |  /|
 *     *-----------*----------26   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |   *-------|--13-------|---*   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   0---|-/-|---*---|-/-|---*
 *     |/  |  /    |/  |  /    |/  |  /
 *     *-----------*-----------*   | /
 *     |   |/      |   |/      |   |/
 *     |   *-------|---*-------|---*
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     *-----------*-----------*
 *
 */
#define q_t5p0 0
#define q_t5p1 24
#define q_t5p2 18
#define q_t5p3 26
#define q_t5p4 12
#define q_t5p5 21
#define q_t5p6 9
#define q_t5p7 13
#define q_t5p8 25
#define q_t5p9 22

#include <vector>
#include "simplex3_mls_q.h"

class cube3_mls_q_t
{
public:
  const static int n_nodes = 27;
  const static int n_nodes_simplex = 10;
  const static int n_nodes_dir = 3;
  const double lip = 5.;

  bool check_for_curvature_;

  double  x0, x1, y0, y1, z0, z1, diag;
  loc_t   loc;
  int     num_of_lsfs;
//  bool    use_linear;

  std::vector<simplex3_mls_q_t> simplex;

  cube3_mls_q_t(double x0 = 0., double x1 = 1., double y0 = 0., double y1 = 1., double z0 = 0., double z1 = 1.)
    : x0(x0), x1(x1), y0(y0), y1(y1), z0(z0), z1(z1), check_for_curvature_(true)
  {
    diag = sqrt(pow(x1-x0, 2.)+
                pow(y1-y0, 2.)+
                pow(z1-z0, 2.));
  }

  inline void set_check_for_curvature(bool value) { check_for_curvature_ = value; }

  void construct_domain(std::vector<double> &phi_all, std::vector<action_t> &acn, std::vector<int> &clr);

  void quadrature_over_domain      (                              std::vector<double> &weights, std::vector<double> &X, std::vector<double> &Y, std::vector<double> &Z);
  void quadrature_over_interface   (int num,                      std::vector<double> &weights, std::vector<double> &X, std::vector<double> &Y, std::vector<double> &Z);
  void quadrature_over_intersection(int num0, int num1,           std::vector<double> &weights, std::vector<double> &X, std::vector<double> &Y, std::vector<double> &Z);
  void quadrature_over_intersection(int num0, int num1, int num2, std::vector<double> &weights, std::vector<double> &X, std::vector<double> &Y, std::vector<double> &Z);
  void quadrature_in_dir           (int dir,                      std::vector<double> &weights, std::vector<double> &X, std::vector<double> &Y, std::vector<double> &Z);
};


/* Splitting of a cube into tetrahedra
 *
 * all arrays should be in the order: 000, 100, 010, 110, 001, 101, 011, 111
 *                                      0,   1,   2,   3,   4,   5,   6,   7
 */


/*
 *           24-----25------26
 *           /|     /|     /|
 *          / |    / |    / |
 *        21-----22------23 |
 *        /| 15--/|-16--/|--17
 *       / | /| / | /| / | /|
 *     18-----19------20 |/ |
 *      | 12---|-13---|--14 |
 *      | /| 06|-/|-07|-/|--08
 *      |/ | / |/ | / |/ | /
 *     09-----10------11 |/
 *      | 03---|-04---|--05
 *      | /    | /    | /
 * z  y |/     |/     |/
 * | /  00-----01-----02
 * |/
 * o---x
 *
 */


/*
 *             o-----------o-----------o
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *         o-----------o-----------o   |
 *        /|   |      /|   |      /|   |
 *       / |   o-----/-|---o-----/-|---o
 *      /  |  /|    /  |  /|    /  |  /|
 *     o-----------o-----------o   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |   o-------|---o-------|---o   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   o---|-/-|---o---|-/-|---o
 *     |/  |  /    |/  |  /    |/  |  /
 *     o-----------o-----------o   | /
 *     |   |/      |   |/      |   |/
 *     |   o-------|---o-------|---o
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     o-----------o-----------o
 *
 */



/*
 *            24----------25----------26
 *            /|          /|          /|
 *           / |         / |         / |
 *          /  |        /  |        /  |
 *        21----------22----------23   |
 *        /|   |      /|   |      /|   |
 *       / |  15-----/-|--16-----/-|--17
 *      /  |  /|    /  |  /|    /  |  /|
 *    18----------19----------20   | / |
 *     |   |/  |   |   |/  |   |   |/  |
 *     |  12-------|--13-------|--14   |
 *     |  /|   |   |  /|   |   |  /|   |
 *     | / |   6---|-/-|---7---|-/-|---8
 *     |/  |  /    |/  |  /    |/  |  /
 *     9----------10----------11   | /
 *     |   |/      |   |/      |   |/
 *     |   3-------|---4-------|---5
 *     |  /        |  /        |  /
 *     | /         | /         | /
 *     |/          |/          |/
 *     0-----------1-----------2
 *
 */

#endif // cube3_mls_q_H
